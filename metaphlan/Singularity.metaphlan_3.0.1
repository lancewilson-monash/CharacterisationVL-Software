Bootstrap: shub
From:      Characterisation-Virtual-Laboratory/CharacterisationVL-Software:1804

%labels
MAINTAINER luhan.cheng@monash.edu
HARDWARE   cpu

%environment 
    export PATH=/usr/local/bin:$PATH

%post 
    # install metaphlan3.0.1, recipe from https://hub.docker.com/layers/biobakery/metaphlan/3.0.1/images/sha256-961e220e247b92acd856c92c777e6b0954e05e8843c173821c5ed1177558b392?context=explore
    apt update -y
    apt-get install -y automake autoconf
    apt-get install -y python python-dev python3 python3-dev python3-pip apt-transport-https openjdk-8-jre wget zip
    pip3 install boto3 cloudpickle awscli
    pip3 install anadama2
    apt-get install -y bowtie2
    pip3 install numpy
    pip3 install cython
    pip3 install biom-format
    apt-get install -y git
    git clone https://github.com/SegataLab/cmseq.git 
    cd cmseq 
    python3 setup.py install 
    cd ../ &&  rm -r cmseq
    
    apt install -y ncbi-blast+
    apt install -y libgsl0-dev

    # install samtools 
    cd /opt
    apt install -y gcc make libbz2-dev zlib1g-dev libncurses5-dev libncursesw5-dev liblzma-dev

    git clone https://github.com/samtools/htslib.git && cd htslib
    autoheader && autoconf
    ./configure --prefix=/usr/local/
    make -j
    make install 
    
    cd /opt
    git clone https://github.com/samtools/bcftools/ && cd bcftools
    autoheader && autoconf 
    ./configure --enable-libgsl  --prefix=/usr/local/
    make -j && make install

    cd /opt
    git clone https://github.com/samtools/samtools && cd samtools
    autoheader && autoconf -Wno-syntax 
    ./configure --prefix=/usr/local
    make -j && make install 
    

    
    pip3 install metaphlan==3.0.1
    

%runscript
    $*

